<template id="template-filter">
  <link rel="stylesheet" href="filter.css">

  <div id="wrapper">
    <div class="filterGroupWrapper">
      <div class="filterType">Classes</div>
      <div class="filterGroup left">
        <form action="#" id="filter-classes-by-type-form">
          <div class="filter">
            <input type="checkbox" id="interfaces" name="interfaces" value="interfaces" checked>
            <label for="interfaces">interfaces</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="classes" name="classes" value="classes" checked>
            <label for="classes">classes</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="hideEmptyPkgs" name="hideEmptyPkgs" value="hideEmptyPkgs" checked>
            <label for="hideEmptyPkgs">hide empty packages</label>
          </div>
          <div class="filter buttons">
            <input type="reset" value="reset" class="button">
            <input type="submit" value="submit" class="button">
          </div>
        </form>
      </div>
    </div>
    <div class="filterGroupWrapper">
      <div class="filterType">Dependencies</div>
      <div class="filterGroup right">
        <form action="#" id="filter-dependencies-by-type-form">
          <div class="filter">
            <input type="checkbox" id="implementing" name="implementing" value="implementing" checked>
            <label for="implementing">implementing</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="extending" name="extending" value="extending" checked>
            <label for="extending">extending</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="constructorCall" name="constructorCall" value="constructorCall" checked>
            <label for="constructorCall">constructor call</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="methodCall" name="methodCall" value="methodCall" checked>
            <label for="methodCall">method call</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="fieldAccess" name="fieldAccess" value="fieldAccess" checked>
            <label for="fieldAccess">field access</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="anonymousImplementation" name="anonymousImplementation" value="anonymousImplementation" checked>
            <label for="anonymousImplementation">anonymous implementation</label>
          </div>
          <div class="filter">
            <input type="checkbox" id="betweenClassAndItsInnerClasses" name="betweenClassAndItsInnerClasses"
                   value="betweenClassAndItsInnerClasses">
            <label for="betweenClassAndItsInnerClasses">between class and its inner classes</label>
          </div>
          <div class="filter buttons">
            <input type="reset" value="reset" class="button">
            <input type="submit" value="submit" class="button">
          </div>
        </form>
      </div>
    </div>
  </div>
</template>

<script>
  (function () {
    const ownerDocument = require('web-component-infrastructure').workarounds.getOwnerDocument();
    let shadowRoot;
    let onClassFilterChanged;
    let onDependenciesFilterChanged;

    function filterClassesByType(form) {
      onClassFilterChanged(form.interfaces.checked, form.classes.checked, form.hideEmptyPkgs.checked);
      return false;
    }

    function filterDependenciesByType(form) {
      onDependenciesFilterChanged({
        implementing: form.implementing.checked,
        extending: form.extending.checked,
        constructorCall: form.constructorCall.checked,
        methodCall: form.methodCall.checked,
        fieldAccess: form.fieldAccess.checked,
        anonymousImplementation: form.anonymousImplementation.checked,
        betweenClassAndItsInnerClasses: form.betweenClassAndItsInnerClasses
      });
      return false;
    }

    class VisualizationFilter extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        shadowRoot = this.attachShadow({mode: 'open'});
        let template = ownerDocument.querySelector('#template-filter');
        shadowRoot.appendChild(template.content.cloneNode(true));

        // FIXME: Remove the whole form thing, just react to key presses
        shadowRoot.querySelector('#filter-classes-by-type-form').onsubmit = function () {
          return filterClassesByType(this);
        };
        shadowRoot.querySelector('#filter-dependencies-by-type-form').onsubmit = function () {
          return filterDependenciesByType(this);
        };
      }

      initialize(newOnClassFilterChanged, newOnDependenciesFilterChanged) {
        onClassFilterChanged = newOnClassFilterChanged;
        onDependenciesFilterChanged = newOnDependenciesFilterChanged;
      }
    }

    window.customElements.define('visualization-filter', VisualizationFilter);
  }());
</script>