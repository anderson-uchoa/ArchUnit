<template id="visualization-filter-template">
  <link rel="stylesheet" href="filter.css">

  <div id="filter-root">
    <div class="filter-group-panel">
      <div class="filter-type">Nodes</div>
      <div class="filter-group">
        <div class="filter">
          <input type="checkbox" class="nodeCheckBox" id="showInterfaces" checked>
          <label for="showInterfaces">show interfaces</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="nodeCheckBox" id="showClasses" checked>
          <label for="showClasses">show classes</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="nodeCheckBox" id="showEmptyPackages">
          <label for="showEmptyPackages">show empty packages</label>
        </div>
      </div>
    </div>
    <div class="filter-group-panel">
      <div class="filter-type">Dependencies</div>
      <div class="filter-group">
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showImplementing" checked>
          <label for="showImplementing">implementing</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showExtending" checked>
          <label for="showExtending">extending</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showConstructorCall" checked>
          <label for="showConstructorCall">constructor call</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showMethodCall" checked>
          <label for="showMethodCall">method call</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showFieldAccess" checked>
          <label for="showFieldAccess">field access</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showAnonymousImplementation" checked>
          <label for="showAnonymousImplementation">anonymous implementation</label>
        </div>
        <div class="filter">
          <input type="checkbox" class="dependencyCheckBox" id="showBetweenClassAndItsInnerClasses">
          <label for="showBetweenClassAndItsInnerClasses">between class and its inner classes</label>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
  const checkBoxesFrom = function (nodes) {
    const checkBoxes = Array.from(nodes);
    const checkboxIdToCheckedBoolean = () => checkBoxes.reduce((result, box) => {
      result[box.id] = box.checked;
      return result;
    }, {});

    return {
      onCheckboxClicked: onClicked => {
        checkBoxes.forEach(box => {
          box.onclick = () => onClicked(checkboxIdToCheckedBoolean())
        });

        onClicked(checkboxIdToCheckedBoolean()); // Sync the initial state
      }
    };
  };

  (function () {
    const webComponents = require('web-component-infrastructure');
    let nodeCheckBoxes;
    let dependencyCheckBoxes;

    webComponents.defineCustomElement('visualization-filter', class extends HTMLElement {
      postConnected() {
        nodeCheckBoxes = checkBoxesFrom(this.shadowRoot.querySelectorAll('.nodeCheckBox'));
        dependencyCheckBoxes = checkBoxesFrom(this.shadowRoot.querySelectorAll('.dependencyCheckBox'));
      }

      onNodeFilterChanged(onNodeFilterChanged) {
        nodeCheckBoxes.onCheckboxClicked(onNodeFilterChanged);
      }

      onDependencyFilterChanged(onDependencyFilterChanged) {
        dependencyCheckBoxes.onCheckboxClicked(onDependencyFilterChanged);
      }
    });
  }());
</script>