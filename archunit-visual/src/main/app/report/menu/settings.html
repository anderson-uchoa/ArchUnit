<template id="template-settings">
  <link rel="stylesheet" href="settings.css">

  <div id="wrapper">
    <div class="settingsWrapper">
      <form action="#" id='settings-form'>
        <div class="setting">
          <label for="circleFontSize">Font size for circle text:</label>
          <input class="number" id="circleFontSize" name="circleFontSize" value="12" min="0" max="50">
        </div>
        <div class="setting">
          <label for="circlePadding">Padding between circles:</label>
          <input class="number" id="circlePadding" name="circlePadding" value="10" min="0">
        </div>
        <div class="setting buttons">
          <input type="reset" value="reset" class="button">
          <input type="submit" value="submit" class="button">
        </div>
      </form>
    </div>
  </div>
</template>

<script>
  (function () {
    const ownerDocument = require('web-component-infrastructure').workarounds.getOwnerDocument();
    const NODE = ".node text";
    const FONT_SIZE = "font-size";
    const CIRCLE = ".circle";
    const PADDING = "padding";
    const UNIT = "px";
    let cssAdapter = require('css-adapter').cssAdapter;
    let shadowRoot;
    let cssSheet;
    let onChanged;

    function applySizes(form) {
      cssAdapter.setStyle(cssSheet, NODE, FONT_SIZE, form.circleFontSize.value, UNIT);
      cssAdapter.setStyle(cssSheet, CIRCLE, PADDING, form.circlePadding.value, UNIT);
      onChanged();
      return false;
    }

    class VisualizationSettings extends HTMLElement {
      constructor() {
        super();
      }

      loadSettingsFromCSSSheet() {
        shadowRoot.querySelector('#circleFontSize').setAttribute("value",
            cssAdapter.getStyleAsNumber(cssSheet, NODE, FONT_SIZE));
        shadowRoot.querySelector('#circlePadding').setAttribute("value",
            cssAdapter.getStyleAsNumber(cssSheet, CIRCLE, PADDING));
      }

      connectedCallback() {
        shadowRoot = this.attachShadow({mode: 'open'});
        let template = ownerDocument.querySelector('#template-settings');
        shadowRoot.appendChild(template.content.cloneNode(true));

        // FIXME: Remove the whole form thing, just react to key presses
        shadowRoot.querySelector('#settings-form').onsubmit = function () {
          return applySizes(this);
        }
      }

      initialize(newSheet, newOnChanged) {
        cssSheet = newSheet;
        this.loadSettingsFromCSSSheet();
        onChanged = newOnChanged;
      }
    }

    window.customElements.define('visualization-settings', VisualizationSettings);
  })();
</script>